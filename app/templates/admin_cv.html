{% extends "base.html" %}
{% block title %}Admin - CV{% endblock %}

{% block content %}
<h2>√âdition du CV</h2>

{% if get_flashed_messages() %}
    <p style="color:green;">{{ get_flashed_messages()[0] }}</p>
{% endif %}

<form method="post">
    <label>Nom</label><br>
    <input type="text" name="nom" value="{{ cv.nom }}"><br><br>

    <label>Titre</label><br>
    <input type="text" name="titre" value="{{ cv.titre }}"><br><br>

    <label>Profil</label><br>
    <textarea name="profil" rows="5">{{ cv.profil }}</textarea><br><br>

    <label>Comp√©tences (s√©par√©es par des virgules)</label><br>
    <input type="text" name="competences" value="{{ cv.competences | join(', ') }}"><br><br>

    <h3>Exp√©riences</h3>
    {% for exp in cv.experiences %}
        {% set i = loop.index0 %}
        <fieldset>
            <legend>Exp√©rience {{ i + 1 }}</legend>
            <label>Poste</label><br>
            <input type="text" name="exp_poste_{{ i }}" value="{{ exp.poste }}"><br>
            <label>Entreprise</label><br>
            <input type="text" name="exp_entreprise_{{ i }}" value="{{ exp.entreprise }}"><br>
            <label>P√©riode</label><br>
            <input type="text" name="exp_periode_{{ i }}" value="{{ exp.periode }}"><br>
            <label>Description</label><br>
            <textarea name="exp_description_{{ i }}">{{ exp.description }}</textarea><br><br>
        </fieldset>
    {% endfor %}

    <h3>Formations</h3>
    {% for form in cv.formations %}
        {% set i = loop.index0 %}
        <fieldset>
            <legend>Formation {{ i + 1 }}</legend>
            <label>Dipl√¥me</label><br>
            <input type="text" name="form_diplome_{{ i }}" value="{{ form.diplome }}"><br>
            <label>Lieu</label><br>
            <input type="text" name="form_lieu_{{ i }}" value="{{ form.lieu }}"><br>
            <label>P√©riode</label><br>
            <input type="text" name="form_periode_{{ i }}" value="{{ form.periode }}"><br>
            <label>Description</label><br>
            <textarea name="form_description_{{ i }}">{{ form.description }}</textarea><br><br>
        </fieldset>
    {% endfor %}

    <button type="button" onclick="ajouterExperience()">‚ûï Ajouter une exp√©rience</button>
    <button type="button" onclick="ajouterFormation()">‚ûï Ajouter une formation</button>
    <br><br>

    <button type="button" onclick="previsualiserEtConfirmer()">üëÅÔ∏è Pr√©visualiser puis sauvegarder</button>
</form>
<script>
function ajouterExperience() {
    const container = document.querySelector("h3:contains('Exp√©riences') + fieldset")?.parentNode;
    if (!container) return;

    const i = container.querySelectorAll("fieldset").length;
    const template = `
        <fieldset>
            <legend>Exp√©rience ${i + 1}</legend>
            <label>Poste</label><br>
            <input type="text" name="exp_poste_${i}" value=""><br>
            <label>Entreprise</label><br>
            <input type="text" name="exp_entreprise_${i}" value=""><br>
            <label>P√©riode</label><br>
            <input type="text" name="exp_periode_${i}" value=""><br>
            <label>Description</label><br>
            <textarea name="exp_description_${i}"></textarea><br><br>
        </fieldset>
    `;
    container.insertAdjacentHTML("beforeend", template);
}

function ajouterFormation() {
    const container = document.querySelector("h3:contains('Formations') + fieldset")?.parentNode;
    if (!container) return;

    const i = container.querySelectorAll("fieldset").length - document.querySelectorAll("h3:contains('Exp√©riences') + fieldset").length;
    const template = `
        <fieldset>
            <legend>Formation ${i + 1}</legend>
            <label>Dipl√¥me</label><br>
            <input type="text" name="form_diplome_${i}" value=""><br>
            <label>Lieu</label><br>
            <input type="text" name="form_lieu_${i}" value=""><br>
            <label>P√©riode</label><br>
            <input type="text" name="form_periode_${i}" value=""><br>
            <label>Description</label><br>
            <textarea name="form_description_${i}"></textarea><br><br>
        </fieldset>
    `;
    container.insertAdjacentHTML("beforeend", template);
}
</script>
<script>
function previsualiserEtConfirmer() {
    const nom = document.querySelector('[name="nom"]').value;
    const titre = document.querySelector('[name="titre"]').value;
    const profil = document.querySelector('[name="profil"]').value;
    const competences = document.querySelector('[name="competences"]').value;

    let message = `üìù Aper√ßu du CV :\n\nNom : ${nom}\nTitre : ${titre}\nProfil : ${profil}\nComp√©tences : ${competences}\n\nContinuer la sauvegarde ?`;
    
    if (confirm(message)) {
        document.querySelector('form').submit();
    }
}
</script>
{% endblock %}
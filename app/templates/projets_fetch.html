{% extends 'base.html' %}

{% block title %}Projets dynamiques{% endblock %}

{% block content %}
<section id="projets-container">
    <h2>Chargement des projets...</h2>
</section>

<script>
fetch("/api/projets")
    .then(response => response.json())
    .then(data => {
        const section = document.getElementById("projets-container");
        section.innerHTML = `
            <h2>Mes projets</h2>
            <form id="ajout-projet-form">
                <h3>Ajouter un projet</h3>
                <input type="text" id="titre" placeholder="Titre" required>
                <input type="text" id="annee" placeholder="Ann√©e" required>
                <textarea id="description" placeholder="Description" required></textarea>
                <button type="submit">Ajouter</button>
            </form>
            <ul>
                ${data.map(p => `
                    <li>
                        <h3>${p.titre} <small>(${p.ann√©e})</small></h3>
                        <p>${p.description}</p>
                    </li>
                `).join('')}
            </ul>
        `;
        document.getElementById("ajout-projet-form").addEventListener("submit", function(e) {
            e.preventDefault();

            const titre = document.getElementById("titre").value.trim();
            const annee = document.getElementById("annee").value.trim();
            const description = document.getElementById("description").value.trim();

            if (!titre || !annee || !description) return alert("Tous les champs sont obligatoires.");

            const nouveauProjet = { titre, ann√©e: annee, description };

            const liste = document.querySelector("#projets-container ul");
            const li = document.createElement("li");
            li.innerHTML = `
                <h3>${nouveauProjet.titre} <small>(${nouveauProjet.ann√©e})</small></h3>
                <p>${nouveauProjet.description}</p>
            `;
            liste.appendChild(li);

            // R√©initialiser le formulaire
            e.target.reset();

            // üîú Option future : POST vers /api/projets/ajouter
        });
    })
    .catch(() => {
        document.getElementById("projets-container").innerHTML = "<p>Erreur lors du chargement.</p>";
    });
</script>
{% endblock %}